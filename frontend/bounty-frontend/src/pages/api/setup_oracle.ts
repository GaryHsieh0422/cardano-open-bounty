import { applyParamsToScript, OfflineEvaluator } from "@meshsdk/core-csl";
import blueprint from "../../../../../aiken-workspace/plutus.json";
import {
  BlockfrostProvider,
  BrowserWallet,
  MeshTxBuilder,
  resolveScriptHash,
  stringToHex,
  deserializeAddress,
  applyCborEncoding,
  serializePlutusScript,
  mOutputReference,
  Data,
  mTuple,
} from "@meshsdk/core";
import { neon } from "@neondatabase/serverless";

export const mintOracleNFT = async (wallet: BrowserWallet) => {
  if (!wallet) {
    alert("Please connect your wallet");
    return;
  }
  if (!process.env.NEXT_PUBLIC_BLOCKFROST_API_KEY) {
    alert("Please set up environment variables");
    return;
  }

  // Set up tx builder with blockfrost support
  const blockfrost: BlockfrostProvider = new BlockfrostProvider(
    process.env.NEXT_PUBLIC_BLOCKFROST_API_KEY,
    0
  );
  const txBuilder: MeshTxBuilder = new MeshTxBuilder({
    fetcher: blockfrost,
    submitter: blockfrost,
    evaluator: new OfflineEvaluator(blockfrost, "preprod"),
  });

  const changeAddress = await wallet.getChangeAddress();
  const utxos = await wallet.getUtxos();
  const collateral = (await wallet.getCollateral())[0];
  const usedAddress = (await wallet.getUsedAddresses())[0];
  const { pubKeyHash, stakeCredentialHash } = deserializeAddress(usedAddress);

  const paramUtxo = utxos[0]!;
  const param: Data = mOutputReference(
    paramUtxo.input.txHash,
    paramUtxo.input.outputIndex
  );

  const OracleNFTSpendingScriptCbor = applyCborEncoding(
    blueprint.validators[16]!.compiledCode
  );

  const OracleNFTAddress = serializePlutusScript(
    {
      code: OracleNFTSpendingScriptCbor,
      version: "V3",
    },
    undefined,
    0
  ).address;

  const OracleNFTMintingScriptCbor = applyParamsToScript(
    blueprint.validators[14]!.compiledCode,
    [param]
  );

  const OracleNFTPolicyId = resolveScriptHash(OracleNFTMintingScriptCbor, "V3");

  const oracleDatum = JSON.stringify({
    constructor: 0,
    fields: [
      {
        bytes: "",
      },
      {
        constructor: 0,
        fields: [
          {
            constructor: 1,
            fields: [
              {
                bytes: "",
              },
            ],
          },
          {
            constructor: 1,
            fields: [],
          },
        ],
      },
      {
        bytes: "",
      },
      {
        constructor: 0,
        fields: [
          {
            constructor: 1,
            fields: [
              {
                bytes: "",
              },
            ],
          },
          {
            constructor: 1,
            fields: [],
          },
        ],
      },
      {
        constructor: 0,
        fields: [
          {
            constructor: 0,
            fields: [
              {
                bytes: pubKeyHash,
              },
            ],
          },
          {
            constructor: 1,
            fields: [
              {
                bytes: stakeCredentialHash,
              },
            ],
          },
        ],
      },
    ],
  });

  try {
    const unsignedTx = await txBuilder
      .txIn(
        paramUtxo.input.txHash,
        paramUtxo.input.outputIndex,
        paramUtxo.output.amount,
        paramUtxo.output.address
      )
      .mintPlutusScriptV3()
      .mint(
        "1",
        OracleNFTPolicyId,
        stringToHex(`${process.env.ORACLE_NFT_ASSET_NAME}`)
      )
      .mintingScript(OracleNFTMintingScriptCbor)
      .mintRedeemerValue(
        JSON.stringify({
          constructor: 0,
          fields: [],
        }),
        "JSON"
      )
      .txOut(OracleNFTAddress, [
        {
          unit:
            OracleNFTPolicyId +
            stringToHex(`${process.env.ORACLE_NFT_ASSET_NAME}`),
          quantity: "1",
        },
      ])
      .txOutInlineDatumValue(oracleDatum, "JSON")
      .txInCollateral(
        collateral.input.txHash,
        collateral.input.outputIndex,
        collateral.output.amount,
        collateral.output.address
      )
      .changeAddress(changeAddress)
      .selectUtxosFrom(utxos)
      .complete();

    const signedTx = await wallet.signTx(unsignedTx, true);
    const txHash = await wallet.submitTx(signedTx);
    console.log(txHash);
    console.log(OracleNFTPolicyId);
    const sql = neon(`${process.env.DATABASE_URL}`);
    await sql(
      "INSERT INTO cardano_open_bounty (name, outputindex, txhash) VALUES ($1, $2, $3)",
      [
        `${process.env.ORACLE_NFT_ASSET_NAME}`,
        paramUtxo.input.outputIndex,
        paramUtxo.input.txHash,
      ]
    );
  } catch (e) {
    console.error(e);
  }
};

export const mintOracleCounter = async (wallet: BrowserWallet) => {
  if (!wallet) {
    alert("Please connect your wallet");
    return;
  }
  if (!process.env.NEXT_PUBLIC_BLOCKFROST_API_KEY) {
    alert("Please set up environment variables");
    return;
  }

  // Set up tx builder with blockfrost support
  const blockfrost: BlockfrostProvider = new BlockfrostProvider(
    process.env.NEXT_PUBLIC_BLOCKFROST_API_KEY,
    0
  );
  const txBuilder: MeshTxBuilder = new MeshTxBuilder({
    fetcher: blockfrost,
    submitter: blockfrost,
    evaluator: new OfflineEvaluator(blockfrost, "preprod"),
  });

  const changeAddress = await wallet.getChangeAddress();
  const utxos = await wallet.getUtxos();
  const collateral = (await wallet.getCollateral())[0];
  const usedAddress = (await wallet.getUsedAddresses())[0];
  const { pubKeyHash, stakeCredentialHash } = deserializeAddress(usedAddress);

  const paramUtxo = utxos[0]!;
  const param: Data = mOutputReference(
    paramUtxo.input.txHash,
    paramUtxo.input.outputIndex
  );

  const idOracleCounterSpendingScriptCbor = applyCborEncoding(
    blueprint.validators[12]!.compiledCode
  );

  const idOracleCounterAddress = serializePlutusScript(
    {
      code: idOracleCounterSpendingScriptCbor,
      version: "V3",
    },
    undefined,
    0
  ).address;

  const idOracleCounterMintingScriptCbor = applyParamsToScript(
    blueprint.validators[14]!.compiledCode,
    [param]
  );

  const idOracleCounterPolicyId = resolveScriptHash(
    idOracleCounterMintingScriptCbor,
    "V3"
  );

  const oracleDatum = JSON.stringify({
    constructor: 0,
    fields: [
      {
        int: 0,
      },
      {
        constructor: 0,
        fields: [
          {
            constructor: 0,
            fields: [
              {
                bytes: pubKeyHash,
              },
            ],
          },
          {
            constructor: 1,
            fields: [
              {
                bytes: stakeCredentialHash,
              },
            ],
          },
        ],
      },
    ],
  });

  try {
    const unsignedTx = await txBuilder
      .txIn(
        paramUtxo.input.txHash,
        paramUtxo.input.outputIndex,
        paramUtxo.output.amount,
        paramUtxo.output.address
      )
      .mintPlutusScriptV3()
      .mint("1", idOracleCounterPolicyId, stringToHex(""))
      .mintingScript(idOracleCounterMintingScriptCbor)
      .mintRedeemerValue(
        JSON.stringify({
          constructor: 0,
          fields: [],
        }),
        "JSON"
      )
      .txOut(idOracleCounterAddress, [
        {
          unit: idOracleCounterPolicyId + stringToHex(""),
          quantity: "1",
        },
      ])
      .txOutInlineDatumValue(oracleDatum, "JSON")
      .txInCollateral(
        collateral.input.txHash,
        collateral.input.outputIndex,
        collateral.output.amount,
        collateral.output.address
      )
      .changeAddress(changeAddress)
      .selectUtxosFrom(utxos)
      .complete();

    const signedTx = await wallet.signTx(unsignedTx, true);
    const txHash = await wallet.submitTx(signedTx);

    console.log(txHash);
    console.log(idOracleCounterPolicyId);

    const sql = neon(`${process.env.DATABASE_URL}`);
    await sql(
      "INSERT INTO cardano_open_bounty (name, outputindex, txhash) VALUES ($1, $2, $3)",
      [
        `${process.env.ID_ORACLE_COUNTER_ASSET_NAME}`,
        paramUtxo.input.outputIndex,
        paramUtxo.input.txHash,
      ]
    );
  } catch (e) {
    console.error(e);
  }
};

export const spendOracleNFT = async (wallet: BrowserWallet) => {
  if (!wallet) {
    alert("Please connect your wallet");
    return;
  }
  if (!process.env.NEXT_PUBLIC_BLOCKFROST_API_KEY) {
    alert("Please set up environment variables");
    return;
  }

  // Set up tx builder with blockfrost support
  const blockfrost: BlockfrostProvider = new BlockfrostProvider(
    process.env.NEXT_PUBLIC_BLOCKFROST_API_KEY,
    0
  );
  const txBuilder: MeshTxBuilder = new MeshTxBuilder({
    fetcher: blockfrost,
    submitter: blockfrost,
    evaluator: new OfflineEvaluator(blockfrost, "preprod"),
  });

  const changeAddress = await wallet.getChangeAddress();
  const utxos = await wallet.getUtxos();
  const collateral = (await wallet.getCollateral())[0];
  const usedAddress = (await wallet.getUsedAddresses())[0];
  const { pubKeyHash, stakeCredentialHash } = deserializeAddress(usedAddress);

  const OracleNFTSpendingScriptCbor = applyCborEncoding(
    blueprint.validators[16]!.compiledCode
  );

  const OracleNFTAddress = serializePlutusScript(
    {
      code: OracleNFTSpendingScriptCbor,
      version: "V3",
    },
    undefined,
    0
  ).address;

  const idSpendingScriptCbor = applyCborEncoding(
    "5909f3010100323232323232323232323223225333006323232323253323300c3001300e37540042646644646464646464646464a666030600660346ea80044c8c94ccc0780040604c94ccc07cc0880084c8c8c8c8c8c94ccc0854ccc084c94ccc088cdc41b8d00600114a0266e3cccdc62400000200c91104000643b000371a910104000643b00014a22a66044921126e616d655f636865636b203f2046616c73650014a02a666042a666042004294454cc0892411469645f6e66745f636865636b203f2046616c73650014a02a666042002294454cc089240118626f756e74795f6e66745f636865636b203f2046616c73650014a02940528180a99918008009129998130008a4000266e012002330020023029001323300100101122533302600114bd700999129998122999812180798131baa33006300c37566022604e6ea8c044c09cdd5001119b8f375c60560026eb8c044c0a0dd50078a5114a0266052004660080080022660080080026050002605200266603e66ebccc03403c94ccc080c02cc088dd51980118041bab300d30233754601a60466ea80048c94ccc088cdc79bae3028302900200513371e00200e2940dd718138008a5114a0980103d87a80004a094488c8cc00400400c894ccc0980045300103d87a800013322533302430050021301333029374e00497ae013300400400137586050002605200266e29220104000de14000333718900419b80371a00290038009bae30223023002375c60420020326eb0c080004c004c8cc004004dd59803980e9baa3007301d37546040603a6ea800c894ccc07c00452f5bded8c0264666444a66603e66e45221000031533301f3371e91010000310011005133024337606ea400cdd3001198030030009bae301e0013756603e002604600460420024646600200200444a66603e002297ae01323332223233001001003225333025001100313233027374e6604e6ea4018cc09cc090004cc09cc0940052f5c0660060066052004604e0026eb8c078004dd5980f80099801801981180118108008a9980ca496365787065637420536f6d65286f776e5f696e70757429203d0a202020202020696e70757473207c3e206c6973742e66696e6428666e28696e70757429207b20696e7075742e6f75747075745f7265666572656e6365203d3d206f776e5f726566207d2900163300500723375e600860366ea800402cc8c8c94ccc064c010c06cdd500089929999998110008a99980d1802980e1baa001132533301f00101a132533333302400101b01b01b01b13232533302200101d1325333333027001132533302400101f1325333333029001020020020020132325333027001022132533333302c0011325333029001024132533333302e0011533302a302d002133300f008133300f003133300f001100d025025025025025025025025302b001302b00202302302302330290013029003375c002604c002604c00403c03c03c03c604800260480066eb8004c084004c074dd500080c80c80c80c80c9919299980d98030008a9980e2481274f7261636c6520696e70757420646f6573206e6f7420636f6e7461696e20616e7920646174756d00161533301b3010001153301c4901224f7261636c6520696e70757420646174756d206d75737420626520696e6c696e6564001613021301e375400460386ea8004c07cc080c080c070dd51803180e1baa301f301c37540022a660349201d165787065637420536f6d65286f7261636c655f696e70757429203d0a202020207265666572656e63655f696e707574730a2020202020207c3e206c6973742e66696e64280a20202020202020202020666e287265665f696e7075743a20496e70757429207b0a2020202020202020202020207175616e746974795f6f66287265665f696e7075742e6f75747075742e76616c75652c206f7261636c655f6e66742e3173742c206f7261636c655f6e66742e326e6429203d3d20310a202020202020202020207d2c0a2020202020202020290016330063758603c603e0124601c66644464a66603a6024603e6ea8004520001375a604660406ea8004c94ccc074c048c07cdd50008a60103d87a8000132330010013756604860426ea8008894ccc08c004530103d87a80001323332225333023337220100062a66604666e3c02000c4c048cc0a0dd400125eb80530103d87a8000133006006001375c60440026eb4c08c004c09c008c094004c8cc004004010894ccc0880045300103d87a80001323332225333022337220100062a66604466e3c02000c4c044cc09cdd300125eb80530103d87a8000133006006001375c60420026eacc088004c098008c090004dd59803180e1baa3006301c37540026eb8c014054dd7180300a911299980d1802980e1baa003132533301f0010021325333333024001132533302100100413253333330260011533302230250021333008003132533301f300a001132533302400100713253333330290011533302530280021325333022300d001132533302700100a132533333302c00115333028302b002133300e00100c00b00b00b00b00b00b3029001302537540042a666044602e002264a66604e002014264a66666605800201601601626464a66605400201a264a66666605e00201c01c01c26464a66605a002020264a666666064002022022022264a66605e60640060260246eb4004044c0bc004c0bc00cdd6800807181600098160019bad00100b30290013025375400401260466ea8004020020020020020c098004c088dd50010a99980f980a0008a99981198111baa0020070060063020375400200a00a00a00a00a00a604600260460040060060060066042002603a6ea800c004888c94ccc068c0140044c94ccc07c00400c4c94cccccc0900040100100100104c94ccc084c09000c018014dd70009810800980e9baa0041533301a300f001132533301f001003132533333302400100400400400413253330213024003006005375c0026042002603a6ea8010008c06cdd50019b87480008c06c0048c068c06c00488c8cc00400400c894ccc0680045300103d87a80001332253330183005002130073301d0024bd70099802002000980e000980e8009ba548000dd6180b00098091baa007301300130133014001300f37540046e1d20021630103011003300f002300e002300e001300937540022930a99803a491856616c696461746f722072657475726e65642066616c7365001365637580022a6600692169657870656374205b28706f6c6963795f69642c207265665f61737365745f6e616d652c205f295d203d0a2020202020206f776e5f696e7075742e6f75747075742e76616c7565207c3e20776974686f75745f6c6f76656c6163652829207c3e20666c617474656e2829001615330024913a657870656374206f7261636c655f696e7075745f646174756d3a204f7261636c65446174756d203d206f7261636c655f696e7075745f6461746100165734ae7155ceaab9e5573eae815d0aba257481"
  );

  const idSpendingScriptAddress = serializePlutusScript(
    {
      code: idSpendingScriptCbor,
      version: "V3",
    },
    undefined,
    0
  ).address;

  const idMintingScriptCbor = applyParamsToScript(
    "59109701010032323232323232323232323232322322322322533300d3232323232533233013300130153754004264a6666660380082646464a66602e600a0022a66603660346ea801c00804854ccc05cc00c00454ccc06cc068dd5003801009009180c1baa006132323232323232323232323232323232533302900102113232533302b001023132533302c302f00213232323232323232323232533303353330333021303537540462a666066a666066a66606666e3c02c0084cdc78048008a99981999b8f00b00113371e01200429405288a9981a24818f69662061737365745f6e616d655f31203d3d207265665f746b6e207b0a202061737365745f6e616d655f32203d3d206e66745f746b6e0a7d20656c73652069662061737365745f6e616d655f31203d3d206e66745f746b6e207b0a202061737365745f6e616d655f32203d3d207265665f746b6e0a7d20656c7365207b0a202046616c73650a7d203f2046616c73650014a02a666066a666066603e014294454cc0d124115616d6f756e745f31203d3d2031203f2046616c73650014a02a666066a666066603e010294454cc0d124115616d6f756e745f32203d3d2031203f2046616c73650014a0264a6660686044606c6ea80044c8c8c94ccc0dd4ccc0dd4ccc0dcc094c0e4dd5191980080099198008009bab301c303c375400a44a66607c002297ae01323332223233001001003225333044001100313233046374e6608c6ea4018cc118c10c004cc118c1100052f5c0660060066090004608c0026eb8c0f4004dd5981f000998018019821001182000091299981e8008a60103d87a800013322533303b32533303c3371e6eb8c108c10c00c02c4cdc78008148a50375c608200426044660806e9c0092f5c02660080080026eb0c0fc004c1000045288a5014a22a660709201187265665f6f75747075745f636865636b203f2046616c73650014a02a66606e002294454cc0e1240113646174756d5f636865636b203f2046616c73650014a029414ccc0d94ccc0d8ccc0d8cdcb9b99375c602e60726ea8005241004a09445288a9981ba4811b646174756d2e67697468756220213d20402222203f2046616c73650014a02a66606c66ebcc064c0e4dd5000a6101800014a22a6606e92121646174756d2e636f6e747269627574696f6e73203d3d205b5d203f2046616c73650014a02940cc894ccc0dccdc3a400860726ea80044c94cccccc10000454ccc0e0c098c0e8dd5000899299981e80081c099299999982100081c81c81c81c89919299982000081d899299999982280081e01e09929998211822801899804800912999822001080489929999998248008a999820981798219baa0011325333046001041132533333304b001042042132325333049001044132533333304e001045045045132533304b304e00313301200422533304d0021300a305000b132533333305200104904904904913230033052004375c002609e00408c6eb4004114c12c004c12c00cdd6000821021182400098221baa001040040040040040304600203d3758002078078608400260840066e64dd7000981f800981d9baa001037037037037037303d303a37540022a660709212365787065637420496e6c696e65446174756d286d795f646174756d29203d20646174610016223233001001003223300300130020023017303837540026074606e6ea800454cc0d5241eb65787065637420536f6d65287265665f6f757470757429203d0a20202020202020202020202020206f7574707574730a202020202020202020202020202020207c3e206c6973742e66696e64280a2020202020202020202020202020202020202020666e286f757470757429207b0a202020202020202020202020202020202020202020206f75747075742e61646472657373203d3d206f7261636c655f696e7075745f646174756d2e69645f746f6b656e5f73746f72655f616464726573730a20202020202020202020202020202020202020207d2c0a2020202020202020202020202020202020202900163301901b23375e602a606e6ea8004c0e8c0ecc0ecc0ecc0dcdd50090a5014a0294054ccc0cd4ccc0cccdc380524002294454cc0d124116616d6f756e745f31203d3d202d31203f2046616c73650014a02a66606666e1c021200114a22a6606892116616d6f756e745f32203d3d202d31203f2046616c73650014a029405288a9981a24811672656465656d65725f636865636b203f2046616c73650014a066e28cdc524504000de1400002b3002375a6026606a6ea803ccdc519b8a48904000643b00002a3001375a602460686ea80388cc008004cc010005200230010012225333031301d00113371666e0000920604890013371666e00cdc1801000a40c066600600666e18008004cdc1800a40286002002444a66605e66e2000920141001133300300333706004900a19b8200148050dd698170021bae302c003375a60580086eb8c0a800c090c0b4004c0b4008c0ac004c94ccc094c044c09cdd50008a5eb7bdb1804dd5981598141baa00133009375660546056605601c02264a6660486024604c6ea80044c94cccccc0b400454ccc094c04cc09cdd50008992999815000812099299999981780081281281289919299981680081389929999998190008a999817181880109998048008803014014014014014014181780098178019bad001025302c001302837540020460460460460466464a66604c60280022a6604e9201274f7261636c6520696e70757420646f6573206e6f7420636f6e7461696e20616e7920646174756d001615333026301200115330274901224f7261636c6520696e70757420646174756d206d75737420626520696e6c696e656400161302c30293754004604e6ea8004c018c09cdd5180398139baa302a302737540022a6604a9201c565787065637420536f6d65286f7261636c655f696e70757429203d0a202020207265666572656e63655f696e707574730a2020202020207c3e206c6973742e66696e64280a20202020202020202020666e287265665f696e7075743a20496e70757429207b0a2020202020202020202020207175616e746974795f6f66287265665f696e7075742e6f75747075742e76616c75652c206f7261636c655f636f756e7465722c20222229203d3d20310a202020202020202020207d2c0a20202020202020202900163300900c230103330083756600e604e6ea8c01cc09cdd500080ca44100325333023301130253754002264a6666660580022a6660486024604c6ea80044c94ccc0a40040884c94cccccc0b800408c08c08c08c4c8c94ccc0b00040944c94cccccc0c40044c94ccc0b800409c4c94cccccc0cc0040a00a00a00a04c8c94ccc0c40040a84c94cccccc0d80044c94ccc0cc0040b04c94cccccc0e000454ccc0d0c0dc0084ccc03c0204ccc03c00c4ccc03c00440340b40b40b40b40b40b40b40b4c0d4004c0d40080ac0ac0ac0acc0cc004c0cc00cdd700098180009818001013013013013181700098170019bae001302b001302737540020420420420420426464a66604a60260022a6604c921274f7261636c6520696e70757420646f6573206e6f7420636f6e7461696e20616e7920646174756d001615333025301100115330264901224f7261636c6520696e70757420646174756d206d75737420626520696e6c696e656400161302b30283754004604c6ea8004c014c098dd5180318131baa3029302637540022a660489201d165787065637420536f6d65286f7261636c655f696e70757429203d0a202020207265666572656e63655f696e707574730a2020202020207c3e206c6973742e66696e64280a20202020202020202020666e287265665f696e7075743a20496e70757429207b0a2020202020202020202020207175616e746974795f6f66287265665f696e7075742e6f75747075742e76616c75652c206f7261636c655f6e66742e3173742c206f7261636c655f6e66742e326e6429203d3d20310a202020202020202020207d2c0a20202020202020202900163300800b2300f3330073756600c604c6ea8c018c098dd50009bae300401a375c600c034444a6660486024604c6ea800c4c94ccc0a40040084c94cccccc0b80044c94ccc0ac0040104c94cccccc0c000454ccc0b0c0bc0084ccc02000c4c94ccc0a4c05c0044c94ccc0b800401c4c94cccccc0cc00454ccc0bcc0c80084c94ccc0b0c0680044c94ccc0c40040284c94cccccc0d800454ccc0c8c0d40084ccc03800403002c02c02c02c02c02cc0cc004c0bcdd50010a999816180c0008992999818800805099299999981b00080580580589919299981a000806899299999981c80080700700709919299981b800808099299999981e000808808808899299981c981e0018098091bad00101130390013039003375a00201c606c002606c0066eb400402cc0cc004c0bcdd500100498169baa0010080080080080083030001302c37540042a666052602a0022a66605a60586ea800801c018018c0a8dd500080280280280280280298168009816801001801801801981580098139baa00300122232533302430120011325333029001003132533333302e001004004004004132533302b302e003006005375c0026056002604e6ea801054ccc090c0400044c94ccc0a400400c4c94cccccc0b80040100100100104c94ccc0acc0b800c018014dd7000981580098139baa004002302537540064604c0024604a604c604c00246048604a00244464a666040601860446ea8004520001375a604c60466ea8004c94ccc080c030c088dd50008a6103d87a8000132330010013756604e60486ea8008894ccc098004530103d87a80001323332225333026337220100062a66604c66e3c02000c4c034cc0acdd400125eb80530103d87a8000133006006001375c604a0026eb4c098004c0a8008c0a0004cc01000c00888c8cc00400400c894ccc08c004530103d87a800013233322253330233372200e0062a66604666e3c01c00c4c028cc0a0dd300125eb80530103d87a8000133006006001375c60440026eacc08c004c09c008c09400488c8cc00400400c894ccc0880045300103d87a8000133225333020300500213007330250024bd70099802002000981200098128009ba548000dd6180f0011bac301d002301d001301c3018375400c6e1d200200f00f00f00f375c6032602c6ea8008dc3a40002c602e6030006602c004602a004602a00260206ea8004526153300e4911856616c696461746f722072657475726e65642066616c73650013656375c0026eb0004dd70008a9980324811072656465656d65723a20416374696f6e0016153300549195657870656374205b506169722861737365745f6e616d655f312c20616d6f756e745f31292c0a202020202020506169722861737365745f6e616d655f322c20616d6f756e745f32295d203d0a2020202020206d696e740a20202020202020207c3e206173736574732e746f6b656e7328706f6c6963795f6964290a20202020202020207c3e20646963742e746f5f70616972732829001615330044913a657870656374206f7261636c655f696e7075745f646174756d3a204f7261636c65446174756d203d206f7261636c655f696e7075745f646174610016153300349141657870656374206f7261636c655f696e7075745f646174756d3a204f7261636c65436f756e746572446174756d203d206f7261636c655f696e7075745f64617461001615330024913565787065637420636f6e74726962757465725f646174756d3a20436f6e7472696275746572446174756d203d206d795f646174756d00165734ae7155ceaab9e5573eae815d0aba257481",
    [
      stringToHex(`${process.env.COLLECTION_NAME!}`),
      mTuple(
        process.env.ORACLE_NFT_POLICY_ID!,
        process.env.ORACLE_NFT_ASSET_NAME!
      ),
      process.env.ID_ORACLE_COUNTER_POLICY_ID!,
    ],
    "Mesh"
  );

  const bountyBoradScriptCbor = applyParamsToScript(
    "59109701010032323232323232323232323232322322322322533300d3232323232533233013300130153754004264a6666660380082646464a66602e600a0022a66603660346ea801c00804854ccc05cc00c00454ccc06cc068dd5003801009009180c1baa006132323232323232323232323232323232533302900102113232533302b001023132533302c302f00213232323232323232323232533303353330333021303537540462a666066a666066a66606666e3c02c0084cdc78048008a99981999b8f00b00113371e01200429405288a9981a24818f69662061737365745f6e616d655f31203d3d207265665f746b6e207b0a202061737365745f6e616d655f32203d3d206e66745f746b6e0a7d20656c73652069662061737365745f6e616d655f31203d3d206e66745f746b6e207b0a202061737365745f6e616d655f32203d3d207265665f746b6e0a7d20656c7365207b0a202046616c73650a7d203f2046616c73650014a02a666066a666066603e014294454cc0d124115616d6f756e745f31203d3d2031203f2046616c73650014a02a666066a666066603e010294454cc0d124115616d6f756e745f32203d3d2031203f2046616c73650014a0264a6660686044606c6ea80044c8c8c94ccc0dd4ccc0dd4ccc0dcc094c0e4dd5191980080099198008009bab301c303c375400a44a66607c002297ae01323332223233001001003225333044001100313233046374e6608c6ea4018cc118c10c004cc118c1100052f5c0660060066090004608c0026eb8c0f4004dd5981f000998018019821001182000091299981e8008a60103d87a800013322533303b32533303c3371e6eb8c108c10c00c02c4cdc78008148a50375c608200426044660806e9c0092f5c02660080080026eb0c0fc004c1000045288a5014a22a660709201187265665f6f75747075745f636865636b203f2046616c73650014a02a66606e002294454cc0e1240113646174756d5f636865636b203f2046616c73650014a029414ccc0d94ccc0d8ccc0d8cdcb9b99375c602e60726ea8005241004a09445288a9981ba4811b646174756d2e67697468756220213d20402222203f2046616c73650014a02a66606c66ebcc064c0e4dd5000a6101800014a22a6606e92121646174756d2e636f6e747269627574696f6e73203d3d205b5d203f2046616c73650014a02940cc894ccc0dccdc3a400860726ea80044c94cccccc10000454ccc0e0c098c0e8dd5000899299981e80081c099299999982100081c81c81c81c89919299982000081d899299999982280081e01e09929998211822801899804800912999822001080489929999998248008a999820981798219baa0011325333046001041132533333304b001042042132325333049001044132533333304e001045045045132533304b304e00313301200422533304d0021300a305000b132533333305200104904904904913230033052004375c002609e00408c6eb4004114c12c004c12c00cdd6000821021182400098221baa001040040040040040304600203d3758002078078608400260840066e64dd7000981f800981d9baa001037037037037037303d303a37540022a660709212365787065637420496e6c696e65446174756d286d795f646174756d29203d20646174610016223233001001003223300300130020023017303837540026074606e6ea800454cc0d5241eb65787065637420536f6d65287265665f6f757470757429203d0a20202020202020202020202020206f7574707574730a202020202020202020202020202020207c3e206c6973742e66696e64280a2020202020202020202020202020202020202020666e286f757470757429207b0a202020202020202020202020202020202020202020206f75747075742e61646472657373203d3d206f7261636c655f696e7075745f646174756d2e69645f746f6b656e5f73746f72655f616464726573730a20202020202020202020202020202020202020207d2c0a2020202020202020202020202020202020202900163301901b23375e602a606e6ea8004c0e8c0ecc0ecc0ecc0dcdd50090a5014a0294054ccc0cd4ccc0cccdc380524002294454cc0d124116616d6f756e745f31203d3d202d31203f2046616c73650014a02a66606666e1c021200114a22a6606892116616d6f756e745f32203d3d202d31203f2046616c73650014a029405288a9981a24811672656465656d65725f636865636b203f2046616c73650014a066e28cdc524504000de1400002b3002375a6026606a6ea803ccdc519b8a48904000643b00002a3001375a602460686ea80388cc008004cc010005200230010012225333031301d00113371666e0000920604890013371666e00cdc1801000a40c066600600666e18008004cdc1800a40286002002444a66605e66e2000920141001133300300333706004900a19b8200148050dd698170021bae302c003375a60580086eb8c0a800c090c0b4004c0b4008c0ac004c94ccc094c044c09cdd50008a5eb7bdb1804dd5981598141baa00133009375660546056605601c02264a6660486024604c6ea80044c94cccccc0b400454ccc094c04cc09cdd50008992999815000812099299999981780081281281289919299981680081389929999998190008a999817181880109998048008803014014014014014014181780098178019bad001025302c001302837540020460460460460466464a66604c60280022a6604e9201274f7261636c6520696e70757420646f6573206e6f7420636f6e7461696e20616e7920646174756d001615333026301200115330274901224f7261636c6520696e70757420646174756d206d75737420626520696e6c696e656400161302c30293754004604e6ea8004c018c09cdd5180398139baa302a302737540022a6604a9201c565787065637420536f6d65286f7261636c655f696e70757429203d0a202020207265666572656e63655f696e707574730a2020202020207c3e206c6973742e66696e64280a20202020202020202020666e287265665f696e7075743a20496e70757429207b0a2020202020202020202020207175616e746974795f6f66287265665f696e7075742e6f75747075742e76616c75652c206f7261636c655f636f756e7465722c20222229203d3d20310a202020202020202020207d2c0a20202020202020202900163300900c230103330083756600e604e6ea8c01cc09cdd500080ca44100325333023301130253754002264a6666660580022a6660486024604c6ea80044c94ccc0a40040884c94cccccc0b800408c08c08c08c4c8c94ccc0b00040944c94cccccc0c40044c94ccc0b800409c4c94cccccc0cc0040a00a00a00a04c8c94ccc0c40040a84c94cccccc0d80044c94ccc0cc0040b04c94cccccc0e000454ccc0d0c0dc0084ccc03c0204ccc03c00c4ccc03c00440340b40b40b40b40b40b40b40b4c0d4004c0d40080ac0ac0ac0acc0cc004c0cc00cdd700098180009818001013013013013181700098170019bae001302b001302737540020420420420420426464a66604a60260022a6604c921274f7261636c6520696e70757420646f6573206e6f7420636f6e7461696e20616e7920646174756d001615333025301100115330264901224f7261636c6520696e70757420646174756d206d75737420626520696e6c696e656400161302b30283754004604c6ea8004c014c098dd5180318131baa3029302637540022a660489201d165787065637420536f6d65286f7261636c655f696e70757429203d0a202020207265666572656e63655f696e707574730a2020202020207c3e206c6973742e66696e64280a20202020202020202020666e287265665f696e7075743a20496e70757429207b0a2020202020202020202020207175616e746974795f6f66287265665f696e7075742e6f75747075742e76616c75652c206f7261636c655f6e66742e3173742c206f7261636c655f6e66742e326e6429203d3d20310a202020202020202020207d2c0a20202020202020202900163300800b2300f3330073756600c604c6ea8c018c098dd50009bae300401a375c600c034444a6660486024604c6ea800c4c94ccc0a40040084c94cccccc0b80044c94ccc0ac0040104c94cccccc0c000454ccc0b0c0bc0084ccc02000c4c94ccc0a4c05c0044c94ccc0b800401c4c94cccccc0cc00454ccc0bcc0c80084c94ccc0b0c0680044c94ccc0c40040284c94cccccc0d800454ccc0c8c0d40084ccc03800403002c02c02c02c02c02cc0cc004c0bcdd50010a999816180c0008992999818800805099299999981b00080580580589919299981a000806899299999981c80080700700709919299981b800808099299999981e000808808808899299981c981e0018098091bad00101130390013039003375a00201c606c002606c0066eb400402cc0cc004c0bcdd500100498169baa0010080080080080083030001302c37540042a666052602a0022a66605a60586ea800801c018018c0a8dd500080280280280280280298168009816801001801801801981580098139baa00300122232533302430120011325333029001003132533333302e001004004004004132533302b302e003006005375c0026056002604e6ea801054ccc090c0400044c94ccc0a400400c4c94cccccc0b80040100100100104c94ccc0acc0b800c018014dd7000981580098139baa004002302537540064604c0024604a604c604c00246048604a00244464a666040601860446ea8004520001375a604c60466ea8004c94ccc080c030c088dd50008a6103d87a8000132330010013756604e60486ea8008894ccc098004530103d87a80001323332225333026337220100062a66604c66e3c02000c4c034cc0acdd400125eb80530103d87a8000133006006001375c604a0026eb4c098004c0a8008c0a0004cc01000c00888c8cc00400400c894ccc08c004530103d87a800013233322253330233372200e0062a66604666e3c01c00c4c028cc0a0dd300125eb80530103d87a8000133006006001375c60440026eacc08c004c09c008c09400488c8cc00400400c894ccc0880045300103d87a8000133225333020300500213007330250024bd70099802002000981200098128009ba548000dd6180f0011bac301d002301d001301c3018375400c6e1d200200f00f00f00f375c6032602c6ea8008dc3a40002c602e6030006602c004602a004602a00260206ea8004526153300e4911856616c696461746f722072657475726e65642066616c73650013656375c0026eb0004dd70008a9980324811072656465656d65723a20416374696f6e0016153300549195657870656374205b506169722861737365745f6e616d655f312c20616d6f756e745f31292c0a202020202020506169722861737365745f6e616d655f322c20616d6f756e745f32295d203d0a2020202020206d696e740a20202020202020207c3e206173736574732e746f6b656e7328706f6c6963795f6964290a20202020202020207c3e20646963742e746f5f70616972732829001615330044913a657870656374206f7261636c655f696e7075745f646174756d3a204f7261636c65446174756d203d206f7261636c655f696e7075745f646174610016153300349141657870656374206f7261636c655f696e7075745f646174756d3a204f7261636c65436f756e746572446174756d203d206f7261636c655f696e7075745f64617461001615330024913565787065637420636f6e74726962757465725f646174756d3a20436f6e7472696275746572446174756d203d206d795f646174756d00165734ae7155ceaab9e5573eae815d0aba257481",
    [
      mTuple(
        process.env.ORACLE_NFT_POLICY_ID!,
        process.env.ORACLE_NFT_ASSET_NAME!
      ),
    ],
    "Mesh"
  );

  const bountyBoardScriptAddress = serializePlutusScript(
    {
      code: bountyBoradScriptCbor,
      version: "V3",
    },
    undefined,
    0
  ).address;

  const bountyMintingScriptCbor = applyParamsToScript(
    "59109701010032323232323232323232323232322322322322533300d3232323232533233013300130153754004264a6666660380082646464a66602e600a0022a66603660346ea801c00804854ccc05cc00c00454ccc06cc068dd5003801009009180c1baa006132323232323232323232323232323232533302900102113232533302b001023132533302c302f00213232323232323232323232533303353330333021303537540462a666066a666066a66606666e3c02c0084cdc78048008a99981999b8f00b00113371e01200429405288a9981a24818f69662061737365745f6e616d655f31203d3d207265665f746b6e207b0a202061737365745f6e616d655f32203d3d206e66745f746b6e0a7d20656c73652069662061737365745f6e616d655f31203d3d206e66745f746b6e207b0a202061737365745f6e616d655f32203d3d207265665f746b6e0a7d20656c7365207b0a202046616c73650a7d203f2046616c73650014a02a666066a666066603e014294454cc0d124115616d6f756e745f31203d3d2031203f2046616c73650014a02a666066a666066603e010294454cc0d124115616d6f756e745f32203d3d2031203f2046616c73650014a0264a6660686044606c6ea80044c8c8c94ccc0dd4ccc0dd4ccc0dcc094c0e4dd5191980080099198008009bab301c303c375400a44a66607c002297ae01323332223233001001003225333044001100313233046374e6608c6ea4018cc118c10c004cc118c1100052f5c0660060066090004608c0026eb8c0f4004dd5981f000998018019821001182000091299981e8008a60103d87a800013322533303b32533303c3371e6eb8c108c10c00c02c4cdc78008148a50375c608200426044660806e9c0092f5c02660080080026eb0c0fc004c1000045288a5014a22a660709201187265665f6f75747075745f636865636b203f2046616c73650014a02a66606e002294454cc0e1240113646174756d5f636865636b203f2046616c73650014a029414ccc0d94ccc0d8ccc0d8cdcb9b99375c602e60726ea8005241004a09445288a9981ba4811b646174756d2e67697468756220213d20402222203f2046616c73650014a02a66606c66ebcc064c0e4dd5000a6101800014a22a6606e92121646174756d2e636f6e747269627574696f6e73203d3d205b5d203f2046616c73650014a02940cc894ccc0dccdc3a400860726ea80044c94cccccc10000454ccc0e0c098c0e8dd5000899299981e80081c099299999982100081c81c81c81c89919299982000081d899299999982280081e01e09929998211822801899804800912999822001080489929999998248008a999820981798219baa0011325333046001041132533333304b001042042132325333049001044132533333304e001045045045132533304b304e00313301200422533304d0021300a305000b132533333305200104904904904913230033052004375c002609e00408c6eb4004114c12c004c12c00cdd6000821021182400098221baa001040040040040040304600203d3758002078078608400260840066e64dd7000981f800981d9baa001037037037037037303d303a37540022a660709212365787065637420496e6c696e65446174756d286d795f646174756d29203d20646174610016223233001001003223300300130020023017303837540026074606e6ea800454cc0d5241eb65787065637420536f6d65287265665f6f757470757429203d0a20202020202020202020202020206f7574707574730a202020202020202020202020202020207c3e206c6973742e66696e64280a2020202020202020202020202020202020202020666e286f757470757429207b0a202020202020202020202020202020202020202020206f75747075742e61646472657373203d3d206f7261636c655f696e7075745f646174756d2e69645f746f6b656e5f73746f72655f616464726573730a20202020202020202020202020202020202020207d2c0a2020202020202020202020202020202020202900163301901b23375e602a606e6ea8004c0e8c0ecc0ecc0ecc0dcdd50090a5014a0294054ccc0cd4ccc0cccdc380524002294454cc0d124116616d6f756e745f31203d3d202d31203f2046616c73650014a02a66606666e1c021200114a22a6606892116616d6f756e745f32203d3d202d31203f2046616c73650014a029405288a9981a24811672656465656d65725f636865636b203f2046616c73650014a066e28cdc524504000de1400002b3002375a6026606a6ea803ccdc519b8a48904000643b00002a3001375a602460686ea80388cc008004cc010005200230010012225333031301d00113371666e0000920604890013371666e00cdc1801000a40c066600600666e18008004cdc1800a40286002002444a66605e66e2000920141001133300300333706004900a19b8200148050dd698170021bae302c003375a60580086eb8c0a800c090c0b4004c0b4008c0ac004c94ccc094c044c09cdd50008a5eb7bdb1804dd5981598141baa00133009375660546056605601c02264a6660486024604c6ea80044c94cccccc0b400454ccc094c04cc09cdd50008992999815000812099299999981780081281281289919299981680081389929999998190008a999817181880109998048008803014014014014014014181780098178019bad001025302c001302837540020460460460460466464a66604c60280022a6604e9201274f7261636c6520696e70757420646f6573206e6f7420636f6e7461696e20616e7920646174756d001615333026301200115330274901224f7261636c6520696e70757420646174756d206d75737420626520696e6c696e656400161302c30293754004604e6ea8004c018c09cdd5180398139baa302a302737540022a6604a9201c565787065637420536f6d65286f7261636c655f696e70757429203d0a202020207265666572656e63655f696e707574730a2020202020207c3e206c6973742e66696e64280a20202020202020202020666e287265665f696e7075743a20496e70757429207b0a2020202020202020202020207175616e746974795f6f66287265665f696e7075742e6f75747075742e76616c75652c206f7261636c655f636f756e7465722c20222229203d3d20310a202020202020202020207d2c0a20202020202020202900163300900c230103330083756600e604e6ea8c01cc09cdd500080ca44100325333023301130253754002264a6666660580022a6660486024604c6ea80044c94ccc0a40040884c94cccccc0b800408c08c08c08c4c8c94ccc0b00040944c94cccccc0c40044c94ccc0b800409c4c94cccccc0cc0040a00a00a00a04c8c94ccc0c40040a84c94cccccc0d80044c94ccc0cc0040b04c94cccccc0e000454ccc0d0c0dc0084ccc03c0204ccc03c00c4ccc03c00440340b40b40b40b40b40b40b40b4c0d4004c0d40080ac0ac0ac0acc0cc004c0cc00cdd700098180009818001013013013013181700098170019bae001302b001302737540020420420420420426464a66604a60260022a6604c921274f7261636c6520696e70757420646f6573206e6f7420636f6e7461696e20616e7920646174756d001615333025301100115330264901224f7261636c6520696e70757420646174756d206d75737420626520696e6c696e656400161302b30283754004604c6ea8004c014c098dd5180318131baa3029302637540022a660489201d165787065637420536f6d65286f7261636c655f696e70757429203d0a202020207265666572656e63655f696e707574730a2020202020207c3e206c6973742e66696e64280a20202020202020202020666e287265665f696e7075743a20496e70757429207b0a2020202020202020202020207175616e746974795f6f66287265665f696e7075742e6f75747075742e76616c75652c206f7261636c655f6e66742e3173742c206f7261636c655f6e66742e326e6429203d3d20310a202020202020202020207d2c0a20202020202020202900163300800b2300f3330073756600c604c6ea8c018c098dd50009bae300401a375c600c034444a6660486024604c6ea800c4c94ccc0a40040084c94cccccc0b80044c94ccc0ac0040104c94cccccc0c000454ccc0b0c0bc0084ccc02000c4c94ccc0a4c05c0044c94ccc0b800401c4c94cccccc0cc00454ccc0bcc0c80084c94ccc0b0c0680044c94ccc0c40040284c94cccccc0d800454ccc0c8c0d40084ccc03800403002c02c02c02c02c02cc0cc004c0bcdd50010a999816180c0008992999818800805099299999981b00080580580589919299981a000806899299999981c80080700700709919299981b800808099299999981e000808808808899299981c981e0018098091bad00101130390013039003375a00201c606c002606c0066eb400402cc0cc004c0bcdd500100498169baa0010080080080080083030001302c37540042a666052602a0022a66605a60586ea800801c018018c0a8dd500080280280280280280298168009816801001801801801981580098139baa00300122232533302430120011325333029001003132533333302e001004004004004132533302b302e003006005375c0026056002604e6ea801054ccc090c0400044c94ccc0a400400c4c94cccccc0b80040100100100104c94ccc0acc0b800c018014dd7000981580098139baa004002302537540064604c0024604a604c604c00246048604a00244464a666040601860446ea8004520001375a604c60466ea8004c94ccc080c030c088dd50008a6103d87a8000132330010013756604e60486ea8008894ccc098004530103d87a80001323332225333026337220100062a66604c66e3c02000c4c034cc0acdd400125eb80530103d87a8000133006006001375c604a0026eb4c098004c0a8008c0a0004cc01000c00888c8cc00400400c894ccc08c004530103d87a800013233322253330233372200e0062a66604666e3c01c00c4c028cc0a0dd300125eb80530103d87a8000133006006001375c60440026eacc08c004c09c008c09400488c8cc00400400c894ccc0880045300103d87a8000133225333020300500213007330250024bd70099802002000981200098128009ba548000dd6180f0011bac301d002301d001301c3018375400c6e1d200200f00f00f00f375c6032602c6ea8008dc3a40002c602e6030006602c004602a004602a00260206ea8004526153300e4911856616c696461746f722072657475726e65642066616c73650013656375c0026eb0004dd70008a9980324811072656465656d65723a20416374696f6e0016153300549195657870656374205b506169722861737365745f6e616d655f312c20616d6f756e745f31292c0a202020202020506169722861737365745f6e616d655f322c20616d6f756e745f32295d203d0a2020202020206d696e740a20202020202020207c3e206173736574732e746f6b656e7328706f6c6963795f6964290a20202020202020207c3e20646963742e746f5f70616972732829001615330044913a657870656374206f7261636c655f696e7075745f646174756d3a204f7261636c65446174756d203d206f7261636c655f696e7075745f646174610016153300349141657870656374206f7261636c655f696e7075745f646174756d3a204f7261636c65436f756e746572446174756d203d206f7261636c655f696e7075745f64617461001615330024913565787065637420636f6e74726962757465725f646174756d3a20436f6e7472696275746572446174756d203d206d795f646174756d00165734ae7155ceaab9e5573eae815d0aba257481",
    [
      mTuple(
        process.env.ORACLE_NFT_POLICY_ID!,
        process.env.ORACLE_NFT_ASSET_NAME!
      ),
    ],
    "Mesh"
  );

  const idMintingPolicyId = resolveScriptHash(idMintingScriptCbor, "V3");
  const bountyMintingPolicyId = resolveScriptHash(
    bountyMintingScriptCbor,
    "V3"
  );

  const oracleDatum = JSON.stringify({
    constructor: 0,
    fields: [
      {
        bytes: idMintingPolicyId,
      },
      {
        constructor: 0,
        fields: [
          {
            constructor: 1,
            fields: [
              {
                bytes: idSpendingScriptAddress,
              },
            ],
          },
          {
            constructor: 1,
            fields: [],
          },
        ],
      },
      {
        bytes: bountyMintingPolicyId,
      },
      {
        constructor: 0,
        fields: [
          {
            constructor: 1,
            fields: [
              {
                bytes: bountyBoardScriptAddress,
              },
            ],
          },
          {
            constructor: 1,
            fields: [],
          },
        ],
      },
      {
        constructor: 0,
        fields: [
          {
            constructor: 0,
            fields: [
              {
                bytes: pubKeyHash,
              },
            ],
          },
          {
            constructor: 1,
            fields: [
              {
                bytes: stakeCredentialHash,
              },
            ],
          },
        ],
      },
    ],
  });

  try {
    const sql = neon(`${process.env.DATABASE_URL}`);
    const queryResult = await sql(
      "SELECT output_index, tx_hash FROM your_table_name WHERE name = $1",
      [`${process.env.ORACLE_NFT_ASSET_NAME}`]
    );

    const { output_index: oracleOutputIndex, tx_hash: oracleTxHash } =
      queryResult[0];

    const unsignedTx = await txBuilder
      .spendingPlutusScriptV3()
      .txIn(oracleTxHash, oracleOutputIndex)
      .txInRedeemerValue(
        JSON.stringify({
          constructor: 0,
          fields: [],
        }),
        "JSON"
      )
      .txInScript(OracleNFTSpendingScriptCbor)
      .txInInlineDatumPresent()
      .txOut(OracleNFTAddress, [
        {
          unit:
            process.env.ORACLE_NFT_POLICY_ID! +
            stringToHex(`${process.env.ORACLE_NFT_ASSET_NAME}`),
          quantity: "1",
        },
      ])
      .txOutInlineDatumValue(oracleDatum, "JSON")
      .txInCollateral(
        collateral.input.txHash,
        collateral.input.outputIndex,
        collateral.output.amount,
        collateral.output.address
      )
      .requiredSignerHash(pubKeyHash)
      .changeAddress(changeAddress)
      .selectUtxosFrom(utxos)
      .complete();

    const signedTx = await wallet.signTx(unsignedTx, true);
    const txHash = await wallet.submitTx(signedTx);
    console.log(txHash);

    const updatedOutputIndex = 0;
    const updatedTxHash = txHash;
    const nftAssetName = process.env.ORACLE_NFT_ASSET_NAME;

    await sql(
      "UPDATE your_table_name SET output_index = $1, tx_hash = $2 WHERE name = $3",
      [updatedOutputIndex, updatedTxHash, nftAssetName]
    );
  } catch (e) {
    console.error(e);
  }
};
